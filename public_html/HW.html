<!DOCTYPE html>
<head>
  <style>
    body {
      background-color: aliceblue;
      padding-left: 5em;
      padding-top: 1em;
    }
    canvas {
      border: solid 1px green;
    }
  </style>
</head>
<html>
  <body>
    <div>
      <h1 style="display: inline">Square Game</h1>
    </div>
    <main>
      <canvas tabindex="0" id="board" width="600px" height="400px"> </canvas>
    </main>
  </body>
  <script>
    // Collect The Square game

    // Get a reference to the canvas DOM element
    var canvas = document.getElementById("board");
    // Get the canvas drawing context
    var context = canvas.getContext("2d");

    // Your score
    var score = 0;

    // Properties for your square
    var x = 50; // X position
    var y = 100; // Y position
    var speed = 6; // Distance to move each frame
    var sideLength = 30; // Length of each side of the square

    // FLags to track which keys are pressed
    var down = false;
    var up = false;
    var right = false;
    var left = false;

    // Properties for the target square
    var targetX = 0;
    var targetY = 0;
    var targetLength = 25;
    // Properties for the target square
    var bonusX = 0;
    var bonusY = 0;
    var bonusLength = 25;
    //target x and y initial speed
    var targetSpeedX = 1;
    var targetSpeedY = 1;
    //starting sec
    var randomSecond = 0;

    // Determine if number a is within the range b to c (exclusive)
    function isWithin(a, b, c) {
      return a > b && a < c;
    }

    // Countdown timer (in seconds)
    var countdown = 30;
    // ID to track the setTimeout
    var id = null;

    // Listen for keydown events
    canvas.addEventListener("keydown", function (event) {
      event.preventDefault();
      console.log(event.key, event.keyCode);
      if (event.keyCode === 40) {
        // DOWN
        down = true;
      }
      if (event.keyCode === 38) {
        // UP
        up = true;
      }
      if (event.keyCode === 37) {
        // LEFT
        left = true;
      }
      if (event.keyCode === 39) {
        // RIGHT
        right = true;
      }
    });

    // Listen for keyup events
    canvas.addEventListener("keyup", function (event) {
      event.preventDefault();
      console.log(event.key, event.keyCode);
      if (event.keyCode === 40) {
        // DOWN
        down = false;
      }
      if (event.keyCode === 38) {
        // UP
        up = false;
      }
      if (event.keyCode === 37) {
        // LEFT
        left = false;
      }
      if (event.keyCode === 39) {
        // RIGHT
        right = false;
      }
    });

    // Show the start menu
    function menu() {
      erase();
      context.fillStyle = "#000000";
      context.font = "36px Arial";
      context.textAlign = "center";
      context.fillText(
        "Collect the Square!",
        canvas.width / 2,
        canvas.height / 4
      );
      context.font = "24px Arial";
      context.fillText("Click to Start", canvas.width / 2, canvas.height / 2);
      context.font = "18px Arial";
      context.fillText(
        "Use the arrow keys to move",
        canvas.width / 2,
        (canvas.height / 4) * 3
      );
      // Start the game on a click
      canvas.addEventListener("click", startGame);
    }

    // Start the game
    function startGame() {
      // Reduce the countdown timer ever second
      id = setInterval(function () {
        countdown--;
      }, 1000);
      // Stop listening for click events
      canvas.removeEventListener("click", startGame);
      // Put the target at a random starting point
      moveTarget();
      //put bonus at random starting point
      movebonus();
      // Kick off the draw loop
      draw();
    }

    // Show the game over screen
    function endGame() {
      // Stop the countdown
      clearInterval(id);
      // Display the final score
      erase();
      context.fillStyle = "#000000";
      context.font = "24px Arial";
      context.textAlign = "center";
      context.fillText(
        "Final Score: " + score,
        canvas.width / 2,
        canvas.height / 2
      );
    }

    // Move the target square to a random position
    function moveTarget() {
      targetX = Math.round(Math.random() * canvas.width - targetLength);
      targetY = Math.round(Math.random() * canvas.height - targetLength);
    }

    //gives bonus a random position
    function movebonus() {
      bonusX = Math.round(Math.random() * canvas.width - bonusLength);
      bonusY = Math.round(Math.random() * canvas.height - bonusLength);
    }

    //makes random sec
    function randomtime(min, max) {
      randomSecond = Math.floor(Math.random() * (max - min + 1) + min);
    }

    // Clear the canvas
    function erase() {
      context.fillStyle = "#FFFFFF";
      context.fillRect(0, 0, 600, 400);
    }

    //erases bonus
    function eraseBonus() {
      bonusX = -50;
      bonusY = -50;
    }

    //draws +10 sec bonus
    function bonus() {
      context.fillStyle = "#000000";
      context.fillRect(bonusX, bonusY, bonusLength, bonusLength);
      if (
        isWithin(bonusX, x, x + bonusLength) ||
        isWithin(bonusX + bonusLength, x, x + bonusLength)
      ) {
        // X
        if (
          isWithin(bonusY, y, y + bonusLength) ||
          isWithin(bonusY + bonusLength, y, y + bonusLength)
        ) {
          eraseBonus();
          countdown = countdown + 10;
        }
      }
    }

    //Gives random direction x to target
    if (Math.floor(Math.random() * 2) == 0) {
      targetSpeedX = -targetSpeedX;
    }
    //Gives random direction y to target
    if (Math.floor(Math.random() * 2) == 0) {
      targetSpeedY = -targetSpeedY;
    }

    randomtime(3, 25);

    // The main draw loop
    function draw() {
      erase();
      // Move the square
      if (down) {
        y += speed;
      }
      if (up) {
        y -= speed;
      }
      if (right) {
        x += speed;
      }
      if (left) {
        x -= speed;
      }

      // Keep the square within the bounds
      if (y + sideLength > canvas.height) {
        y = canvas.height - sideLength;
      }
      if (y < 0) {
        y = 0;
      }
      if (x < 0) {
        x = 0;
      }
      if (x + sideLength > canvas.width) {
        x = canvas.width - sideLength;
      }

      //Moves target
      targetX += targetSpeedX;
      targetY += targetSpeedY;

      // bounce target
      if (targetX < 0 && targetSpeedX < 0) {
        targetSpeedX = -targetSpeedX;
      }
      if (targetX + targetLength > canvas.width && targetSpeedX > 0) {
        targetSpeedX = -targetSpeedX;
      }
      if (targetY < 0 && targetSpeedY < 0) {
        targetSpeedY = -targetSpeedY;
      }
      if (targetY + targetLength > canvas.height && targetSpeedY > 0) {
        targetSpeedY = -targetSpeedY;
      }

      // Collide with the target
      if (
        isWithin(targetX, x, x + sideLength) ||
        isWithin(targetX + targetLength, x, x + sideLength)
      ) {
        // X
        if (
          isWithin(targetY, y, y + sideLength) ||
          isWithin(targetY + targetLength, y, y + sideLength)
        ) {
          // Y
          // Respawn the target
          moveTarget();
          // Increase the score
          score++;

          //increases target's speed every 5 points
          if (score % 5 == 0) {
            if (targetSpeedX < 0) {
              targetSpeedX -= 1;
            }
            if (targetSpeedX > 0) {
              targetSpeedX += 1;
            }
            if (targetSpeedY < 0) {
              targetSpeedY -= 1;
            }
            if (targetSpeedY > 0) {
              targetSpeedY += 1;
            }
          }
        }
      }

      // Draw the square
      context.fillStyle = "#FF0000";
      context.fillRect(x, y, sideLength, sideLength);
      // Draw the target
      context.fillStyle = "#00FF00";
      context.fillRect(targetX, targetY, targetLength, targetLength);
      // Draw the score and time remaining
      context.fillStyle = "#000000";
      context.font = "24px Arial";
      context.textAlign = "left";
      context.fillText("Score: " + score, 10, 24);
      context.fillText("Time Remaining: " + countdown, 10, 50);

      //appears bonus after random sec
      if (countdown <= randomSecond) {
        bonus();
        //erase bonus if not collected within 2 sec
        if (countdown <= randomSecond - 2 && !bonus()) {
          eraseBonus();
        }
      }

      // End the game or keep playing
      if (countdown <= 0) {
        endGame();
      } else {
        window.requestAnimationFrame(draw);
      }
    }

    // Start the game
    menu();
    canvas.focus();
  </script>
</html>
